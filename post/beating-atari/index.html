<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Souhaib Attaiki">

  
  
  
    
  
  <meta name="description" content="Introduction Advances in the field of reinforcement learning are increasing, the aim being to teach AI to achieve human performance in everyday tasks. One of the important area of research in reinforcement learning is to train agents directly from high-dimensional sensory inputs like vision. In this sense, video games can be considered a good way to test and improve reinforcement learning algorithms, mainly because they offer several different scenarios that require different types of policies to be solved.">

  
  <link rel="alternate" hreflang="en-us" href="https://pvnieo.github.io/post/beating-atari/">

  


  

  
  
  
  <meta name="theme-color" content="rgb(0, 136, 204)">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light" disabled>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cutive+Mono|Lora:400,700|Roboto:400,700&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.72134522a6d8af1d590edd0a7d65c8ad.css">

  

  
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://pvnieo.github.io/post/beating-atari/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="pvnieo">
  <meta property="og:url" content="https://pvnieo.github.io/post/beating-atari/">
  <meta property="og:title" content="The genesis of beating Atari games | pvnieo">
  <meta property="og:description" content="Introduction Advances in the field of reinforcement learning are increasing, the aim being to teach AI to achieve human performance in everyday tasks. One of the important area of research in reinforcement learning is to train agents directly from high-dimensional sensory inputs like vision. In this sense, video games can be considered a good way to test and improve reinforcement learning algorithms, mainly because they offer several different scenarios that require different types of policies to be solved."><meta property="og:image" content="https://pvnieo.github.io/post/beating-atari/featured.jpg">
  <meta property="twitter:image" content="https://pvnieo.github.io/post/beating-atari/featured.jpg"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-08-25T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2019-08-25T00:00:00&#43;00:00">
  

  


  





  <title>The genesis of beating Atari games | pvnieo</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="dark">

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/"><img src="/img/icon.png" alt="pvnieo"></a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  




















  
  


<div class="article-container pt-3">
  <h1 itemprop="name">The genesis of beating Atari games</h1>

  

  



<meta content="2019-08-25 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2019-08-25 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Aug 25, 2019</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    16 min read
  </span>
  

  
  
  

  
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://pvnieo.github.io/post/beating-atari/&amp;text=The%20genesis%20of%20beating%20Atari%20games" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://pvnieo.github.io/post/beating-atari/&amp;t=The%20genesis%20of%20beating%20Atari%20games" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://pvnieo.github.io/post/beating-atari/&amp;title=The%20genesis%20of%20beating%20Atari%20games" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

  
















</div>


<div class="article-header container-fluid featured-image-wrapper mt-4 mb-4" style="max-width: 1920px; max-height: 1080px;">
  <div style="position: relative">
    <img src="/post/beating-atari/featured.jpg" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <h1 id="introduction">Introduction</h1>

<p>Advances in the field of reinforcement learning are increasing, the aim
being to teach AI to achieve human performance in everyday tasks. One of
the important area of research in reinforcement learning is to train
agents directly from high-dimensional sensory inputs like vision. In
this sense, video games can be considered a good way to test and improve
reinforcement learning algorithms, mainly because they offer several
different scenarios that require different types of policies to be
solved.</p>

<p>In this blog, we will focus on beating Atari 2600 games, by training
reinforcement learning algorithms to find the optimal control policy
from solely raw video frames. For that, we will present approaches that
harness the high quality of extracted features from high dimensional
state spaces as an image, made by the recent advances of Convolutional
Neural Networks (CNNs) (see <sup class="footnote-ref" id="fnref:1"><a class="footnote" href="#fn:1">1</a></sup> and <sup class="footnote-ref" id="fnref:2"><a class="footnote" href="#fn:2">2</a></sup>). Such features were hand-crafted
under previous successful approaches, which had limited the scope of
application.</p>

<p>In particular, we will present the <strong>Deep Q-Network (DQN)</strong> algorithm,
published by the DeepMind team in 2013 <sup class="footnote-ref" id="fnref:3"><a class="footnote" href="#fn:3">3</a></sup>, marking a milestone in
machine learning, as well as the improvements made by the same team to
their algorithm in 2015 in <sup class="footnote-ref" id="fnref:4"><a class="footnote" href="#fn:4">4</a></sup> and <sup class="footnote-ref" id="fnref:5"><a class="footnote" href="#fn:5">5</a></sup>.</p>

<h1 id="background">Background</h1>

<p>Reinforcement learning is about discovering an <strong>optimal policy</strong> (how
to map situations to actions), in order to maximize a numerical reward
signal. The agent is not told which action yields the maximum reward,
but must discover it by interacting with the environment and exploring
all possible scenarios.</p>

<p>One way of finding the optimal policy is through <strong>Q-learning</strong>. The
latter is based on an action-value function $Q$ (Q for quality), which
assign for each state <strong>s</strong>, and a possible action <strong>a</strong>, following a
policy $\pi$, an estimate of the total reward we would achieve starting
at <strong>s</strong>, taking the action <strong>a</strong> then following the same policy (This expression is valid for the Infinite time horizon with terminal state setting, which we are interested in in this study):</p>

<p><span  class="math">\[Q^{\pi}(s,a) = \operatorname{\mathbb{E}}[\sum_{t' = t}^{T} \gamma^{t' - t} r_{t'} |s_t = s, a_t = a, \pi]\]</span></p>

<p>We define the optimal action-value function <span  class="math">\(Q^{*}(s,a)\)</span> as
<span  class="math">\(Q^{*}(s,a) = max_{\pi} Q^{\pi}(s,a)\)</span>, which correspond to the optimal
policy. If <span  class="math">\(Q^{*}(s,a)\)</span> is known for each state and action, then the
optimal policy is nothing more than the <em>greedy policy</em>:
<span  class="math">\(\pi^{*}(s) = argmax_a Q^{*}(s,a)\)</span>.</p>

<p>The basic idea behind Q-learning algorithm is that the optimal
action-value function obeys the <em>Bellman equation</em>:
<span  class="math">\(Q^{*}(s,a) = \operatorname{\mathbb{E}}_{s' \sim \mathcal{E}} [r + \gamma max_{a'} Q^{*}(s',a') | s, a]\)</span></p>

<p>This will allow us to estimate the value of the action-value function by
using this identity as an iterative update. This algorithm was
introduced by Ch. Watkins <sup class="footnote-ref" id="fnref:6"><a class="footnote" href="#fn:6">6</a></sup> and it was proven to converge to
the optimal action-value function if there are finite number of states
and each of the state-action pair is presented repeatedly
<sup class="footnote-ref" id="fnref:7"><a class="footnote" href="#fn:7">7</a></sup>.</p>

<p>However, in our case, the problem is too large to learn all action
values in all states separately, and the classical Q-learning algorithm
is not adapted. Instead, a function approximator will be used to
approximate the action-value function
$Q(s, a; \theta) \approx Q^{*}(s,a)$. In this project, we will discuss
the approximation using a neural network, commonly called Deep
Q-Learning.</p>

<p>The neural network is trained to minimize an objective function that
mimic the behavior of the standard Q-learning update rule:
<span  class="math">\(\mathcal{L}(\theta) = \operatorname{\mathbb{E}}\big[\big( r + \gamma max_{a'} Q(s', a', \theta) - Q(s, a, \theta) \big)^2\big]\)</span></p>

<p>This objective function is optimized end-to-end by stochastic gradient
descent, using the following gradient:
<span  class="math">\(\frac{\partial \mathcal{L}}{\partial \theta} = \operatorname{\mathbb{E}}\big[\big( r + \gamma max_{a'} Q(s', a', \theta) - Q(s, a, \theta) \big) \frac{\partial Q(s, a, \theta)}{\partial \theta}\big]
\label{grad}\)</span></p>

<p>Using non linear function approximator with the reinforcement learning
setting is know to be unstable or even diverge <sup class="footnote-ref" id="fnref:8"><a class="footnote" href="#fn:8">8</a></sup><sup class="footnote-ref" id="fnref:4"><a class="footnote" href="#fn:4">9</a></sup>,
and this mainly due to:</p>

<ul>
<li><p><strong>Training data is corelated</strong>:   Because the learning agent obtains the learning data by interacting
with the environment, this data is not <strong>i.i.d</strong>. because successive
samples are correlated</p></li>

<li><p><strong>Moving target values</strong>:   this due to the fact that small changes to the action-value function
Q may have big impact on the policy, so the policy may oscillate,
and this cause the data to swing from one extreme to another</p></li>

<li><p><strong>Scale of rewards and Q-values is unknown</strong>:   resulting in large changes in loss from update to update, causing
exploding gradient which poorly affect back propagation</p></li>
</ul>

<p>In the following, we will show the techniques used to overcome the
causes of the instability of training Deep Q-learning models.</p>

<p>It should be noted that Deep Q-learning algorithm is <strong>model-free</strong>,
meaning that it solves the reinforcement learning task by searching over
policy space to find policies that result in better reward without
learning a model of the environment. It’s also <strong>off-policy</strong>, meaning
that the learned action-value function, $Q$, directly approximates $Q^*$
, the optimal action-value function, independent of the policy being
followed<sup class="footnote-ref" id="fnref:9"><a class="footnote" href="#fn:9">10</a></sup>.</p>

<h1 id="atari-2600">Atari 2600</h1>

<p>The Atari 2600 is a home video game console that was sold in various
versions by Atari Inc. from 1977 to 1992. It introduced or popularized
many arcade video games that are now considered classics, such as Pong,
Breakout, and Space Invaders. Bellemare et.al <sup class="footnote-ref" id="fnref:10"><a class="footnote" href="#fn:10">11</a></sup> have
introduced in 2013 the Arcade Learning Environment, which is an emulator
for testing and evaluating reinforcement learning algorithms on Atari
2600 games. Since, it’s used as a rigorous testbed for evaluating and
comparing approaches on a very large set of problems.</p>

<p>A human playing an Atari game sees $210 \times 160 \times 3$ RGB image,
and the game state is updated every time the agent makes an action. The
user can perform 18 actions with the joystick: doing nothing, pressing
the action button, going in one of 8 directions (up, down, left and
right as well as the 4 diagonals) and going in any of these directions
while pressing the button. Depending on the game, only a subset of these
actions is used. For example, only 4 actions are used to control the
Breakout game: doing nothing, moving left or right, and the action
button for summoning the ball.</p>

<h2 id="preprocessing">Preprocessing</h2>

<p>A preprocessing step is applied to the frames returned by the
environment. In fact, in order to reduce computation complexity, all
frames are preprocessed by converting them to gray-scale, down-sampling
them to have a shape of $110 \times 84$, and cropping the images to have
a size of $84 \times 84 \times 1$ <sup class="footnote-ref" id="fnref:see-figure"><a class="footnote" href="#fn:see-figure">0</a></sup>.</p>

<p><figure><img src="./preprocess.jpeg" alt="png"></figure></p>

<p>Another important preprocessing step is stacking frames. Since one frame
cannot have all the necessary information - such as direction of motion,
speed or acceleration - for the agent to make decisions, a set of the
last four frames will be stacked.</p>

<p>So at the end of the preprocessing step, each state that will be
observed by the agent has the format of $84 \times 84 \times 4$.This
preprocessing will be denoted by $\phi$.</p>

<h1 id="deep-qnetwork">Deep Q-Network</h1>

<p>Deep Q-Network is an algorithm introduced first by Mnih et.al <sup class="footnote-ref" id="fnref:3"><a class="footnote" href="#fn:3">12</a></sup>
in NIPS 2013, and an improved version of it <sup class="footnote-ref" id="fnref:4"><a class="footnote" href="#fn:4">13</a></sup> was published on
Nature 2015. DQN combines Q-learning with a flexible deep neural
network, and was tested on a varied and large set of Atari 2600 games,
reaching super human-level performance on many games.</p>

<h2 id="basic-dqn">Basic DQN</h2>

<p>The basic DQN is a multi-layered neural network that for a given state
$s$ outputs a vector of action values $Q(s, · ; \theta)$, where $\theta$
are the parameters of the network.</p>

<p>The success of DQN is essentially due to the use of CNNs to extract
relevant features from raw frames, and the use of the experience
replay<sup class="footnote-ref" id="fnref:11"><a class="footnote" href="#fn:11">14</a></sup> method to stabilize the learning.</p>

<p>The problem of Online-learning (which is learning from streaming data)is
that the samples arrive in order they are experienced and, as such, are
highly correlated. The other problem is that the samples are immediately
thrown away after using them, as a result, we are not learning from our
experience effectively. The experience replay is performed by storing
the agent experiences at each time-step,
<span  class="math">\(e_t = (s_t, a_t, r_t, a_{t+1})\)</span>, into a data set
$\mathcal{D} = e_1, e_2, ..., e_N$ called <em>replay memory</em>, and during
each learning step, a <em>random batch</em> is sampled from $\mathcal{D}$, and
a gradient descent is performed on it. The experience replay method
breaks the correlation in data, bringing the problem back to i.i.d
setting, and also enable the agent to learn from past policies.</p>

<p>Following the greedy policy only may not be sufficient to discover the
optimal policy since there no exploration. To overcome this, an
$\epsilon$-greedy policy is used, where the greedy action is selected
with a probability of (1 - $\epsilon$), and a random action is selected
with probability $\epsilon$. During training, this $\epsilon$ is
annealed linearly between 1 and 0.1, decreasing with each time-step.</p>

<p>The full algorithm is presented in <strong>Algorithm 1</strong>.</p>

<hr>

<p><strong>Algorithm 1</strong> Deep Q-learning with Experience Replay</p>

<hr>

<p>Initialize replay memory D to capacity N<br>
nitialize action-value function Q with random weights<br>
<strong>for</strong> episode = 1, M <strong>do</strong></p>

<blockquote>
<p>Initialise sequence <span  class="math">\(s_1 = \left\{ x_1\right\}\)</span> and preprocessed
sequenced $\phi_1 = \phi(s1)$<br>
<strong>for</strong> t = 1, T <strong>do</strong></p>

<blockquote>
<p>With probability $\epsilon$ select a random action $a_t$<br>
otherwise select $a_t = max_a Q^*(\phi(s_t), a; \theta)$<br>
Execute action <span  class="math">\(a_t\)</span> in emulator and observe reward <span  class="math">\(r_t\)</span> and image
<span  class="math">\(x_{t+1}\)</span><br>
set <span  class="math">\(s_{t+1} = s_t\)</span> and preprocess <span  class="math">\(\phi_{t+1} = \phi(s_{t+1})\)</span><br>
Store transition<span  class="math">\((\phi_t, a_t, r_t, \phi_{t+1})\)</span> in <span  class="math">\(\mathcal{D}\)</span><br>
Sample random minibatch of transitions <span  class="math">\((\phi_j, a_j, r_j, \phi_{j+1})\)</span>
from <span  class="math">\(\mathcal{D}\)</span><br>
Set <span  class="math">\(y_j = \left\{
\begin{array}{ll}
r_j & \text{for terminal } \phi_{j+1} \\
r_j + \gamma max_{a'} Q(\phi_{j+1}, a'; \theta) & \text{for non-terminal } \phi_{j+1}
\end{array}
\right.\)</span><br>
Perform a gradient descent step on
$\big( y_j - Q(\phi_j, a_j; \theta)    \big)^2$ according to equation
[grad]</p>
</blockquote>

<p><strong>end for</strong></p>
</blockquote>

<p><strong>end for</strong></p>

<hr>

<p></p>

<p>Another technique used to stabilize the training is <em>clipping reward</em>,
in which all positive rewards are set +1 and all negative rewards are
set -1. This technique aims to limits the scale of the error derivatives
and prevent from the exploding gradient.</p>

<p>Finally, the architecture of the network is provided in the following table.
The network is a convolutional neural network, composed of two
convolutional layers, followed by a flatten layer, and the final layers
are two fully-connected layers. The network takes as an input a
preprocessed state that has the size of $84 \times 84 \times 4$, as
explained before. The output of the network of size $n = 18$,
corresponding to the number of possible actions.</p>

<table>
<thead>
<tr>
<th align="center">Layer</th>
<th align="center">Input</th>
<th align="center">Filter size</th>
<th align="center">Stride</th>
<th align="center">Num filters</th>
<th align="center">Activation</th>
<th align="left">Output</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">conv1</td>
<td align="center"><span  class="math">\(84 \times 84 \times 4\)</span></td>
<td align="center">$8 \times 8$</td>
<td align="center">4</td>
<td align="center">16</td>
<td align="center">ReLU</td>
<td align="left"><span  class="math">\(20 \times 20 \times 16\)</span></td>
</tr>

<tr>
<td align="center">conv2</td>
<td align="center">$20 \times 20 \times 16$</td>
<td align="center">$4 \times 4$</td>
<td align="center">2</td>
<td align="center">32</td>
<td align="center">ReLU</td>
<td align="left"><span  class="math">\(9 \times 9 \times 32\)</span></td>
</tr>

<tr>
<td align="center">fc3</td>
<td align="center">$9 \times 9 \times 32$</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">256</td>
<td align="center">ReLU</td>
<td align="left">256</td>
</tr>

<tr>
<td align="center">fc4</td>
<td align="center">256</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">18</td>
<td align="center">Linear</td>
<td align="left">18</td>
</tr>
</tbody>
</table>

<h2 id="improved-dqn">Improved DQN</h2>

<p>In 2015, DeepMind published a new version <sup class="footnote-ref" id="fnref:4"><a class="footnote" href="#fn:4">15</a></sup> of their algorithm
DQN, that seems not only to perform the first version, but also achieved
a level comparable to that of a professional human games tester across a
set of 49 games, using the same algorithm, network architecture and
hyperparameters.</p>

<p>The main differences between the new and the old architecture is the use
of a bigger CNN to catch more complex features, and the use of a target
network.</p>

<p>The target network is used to prevent the <strong>moving target values</strong>
problem(see section [background]). The target network $Q-$ is a neural
network parameterized by $\theta^-$ has the same architecture as the
action-value network $Q$, but instead of the latter, whose parameters
$\theta$ are updated at each iteration, the parameters of the target
network are updated periodically, using a copy of the parameters of the
Q-network. Practically, the parameters $\theta^-$ of the $Q-$ network
are updated every 10000 iterations.</p>

<p>The target network is used to generate the targets $y_i$ in the
Q-learning updates. This modification makes the algorithm more stable
compared to standard online Q-learning, where an update that increases
<span  class="math">\(Q(s_t,a_t)\)</span> often also increases $Q(s_{t+1},a')$ and hence also
increases the target $y_j$, possibly leading to oscillations or
divergence of the policy.</p>

<p>The full improved DQN algorithm is presented in <strong>Algorithm 2</strong>.</p>

<hr>

<p><strong>Algorithm 2</strong> Improved Deep Q-learning with Experience Replay</p>

<hr>

<p>Initialize replay memory D to capacity N<br>
Initialize action-value function $Q$ with random weights $\theta$<br>
Initialize e target action-value function $Q^-$ with weights
$\theta^- = \theta$<br>
<strong>for</strong> episode = 1, M <strong>do</strong></p>

<blockquote>
<p>Initialise sequence <span  class="math">\(s_1 = \left\{ x_1\right\}\)</span> and preprocessed
sequenced $\phi_1 = \phi(s1)$<br>
<strong>for</strong> t = 1, T <strong>do</strong></p>

<blockquote>
<p>With probability $\epsilon$ select a random action $a_t$<br>
otherwise select $a_t = max_a Q^*(\phi(s_t), a; \theta)$<br>
Execute action $a_t$ in emulator and observe reward <span  class="math">\(r_t\)</span> and image
<span  class="math">\(x_{t+1}\)</span><br>
set <span  class="math">\(s_{t+1} = s_t\)</span> and preprocess <span  class="math">\(\phi_{t+1} = \phi(s_{t+1})\)</span><br>
Store transition<span  class="math">\((\phi_t, a_t, r_t, \phi_{t+1})\)</span> in <span  class="math">\(\mathcal{D}\)</span><br>
Sample random minibatch of transitions <span  class="math">\((\phi_j, a_j, r_j, \phi_{j+1})\)</span>
from <span  class="math">\(\mathcal{D}\)</span><br>
Set <span  class="math">\( y_j = \left\{
\begin{array}{ll}
r_j & \text{for terminal } \phi_{j+1} \\
r_j + \gamma max_{a'} Q^-(\phi_{j+1}, a'; \theta^-) & \text{for non-terminal } \phi_{j+1}
\end{array}
\right.\)</span><br>
Perform a gradient descent step on
$\big( y_j - Q(\phi_j, a_j; \theta)    \big)^2$ with respect to the
network parameters $\theta$<br>
Every C steps, reset $Q^- = Q$</p>
</blockquote>

<p><strong>end for</strong></p>
</blockquote>

<p><strong>end for</strong></p>

<hr>

<p>Another improvement made to the basic DQN algorithm is the use of
<em>Hubber loss</em>. Instead of the squared error loss
while computing the error term from
<span  class="math">\( r_j + \gamma max_{a'} Q^-(\phi_{j+1}, a'; \theta^-) - Q^-(\phi_{j+1}, a'; \theta^-) \)</span>,
which had the property of being less sensitive to outliers in data than
the squared error loss. This form of error clipping further improved the
stability of the algorithm <sup class="footnote-ref" id="fnref:4"><a class="footnote" href="#fn:4">16</a></sup>.</p>

<p><span  class="math">\[\label{hubber}
\mathcal{L}(a) = \left\{
\begin{array}{ll}
\frac{1}{2} a^2  & \text{for } |a| \leq 1\\
|a| - \frac{1}{2} & \text{otherwise}
\end{array}
\right.\]</span></p>

<p>Finally, the improved DQN used a bigger CNN. In particular, the number
of filters is doubled, and a convolutional layer is added before the
first fully connected layer. Details of the architecture are provided in the
table bellow.</p>

<p>When evaluated, the improved DQN outperforms the best existing
reinforcement learning methods on 43 of the games without incorporating
any of the additional prior knowledge about Atari 2600 games used by
other approaches. Furthermore, it has performed at a level that was
comparable to that of a professional human games tester across the set
of 49 games, achieving more than 75% of the human score on more than
half of the games (29 games).</p>

<table>
<thead>
<tr>
<th align="center">Layer</th>
<th align="center">Input</th>
<th align="center">Filter size</th>
<th align="center">Stride</th>
<th align="center">Num filters</th>
<th align="center">Activation</th>
<th align="left">Output</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">conv1</td>
<td align="center"><span  class="math">\(84 \times 84 \times 4\)</span></td>
<td align="center">$8 \times 8$</td>
<td align="center">4</td>
<td align="center">32</td>
<td align="center">ReLU</td>
<td align="left"><span  class="math">\(20 \times 20 \times 32\)</span></td>
</tr>

<tr>
<td align="center">conv2</td>
<td align="center">$20 \times 20 \times 32$</td>
<td align="center">$4 \times 4$</td>
<td align="center">2</td>
<td align="center">64</td>
<td align="center">ReLU</td>
<td align="left"><span  class="math">\(9 \times 9 \times 64\)</span></td>
</tr>

<tr>
<td align="center">conv3</td>
<td align="center">$9 \times 9 \times 64$</td>
<td align="center">$3 \times 3$</td>
<td align="center">1</td>
<td align="center">64</td>
<td align="center">ReLU</td>
<td align="left"><span  class="math">\(7 \times 7 \times 64\)</span></td>
</tr>

<tr>
<td align="center">fc4</td>
<td align="center">$7 \times 7 \times 64$</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">256</td>
<td align="center">ReLU</td>
<td align="left">512</td>
</tr>

<tr>
<td align="center">fc5</td>
<td align="center">512</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">18</td>
<td align="center">Linear</td>
<td align="left">18</td>
</tr>
</tbody>
</table>

<h2 id="double-dqn">Double DQN</h2>

<p>Double DQN (DDQN) is another improvement to the previous DQN algorithm.
In fact, another team from DeepMind showed in their publication
<sup class="footnote-ref" id="fnref:5"><a class="footnote" href="#fn:5">17</a></sup> that the previous deep Q-Learning algorithm has tendency to
overestimate the Q function value, due to the max in the formula used to
set targets: <span  class="math">\(Q(s,a) \rightarrow r + \gamma max_a Q(s', a)\)</span></p>

<p>This overestimation wouldn’t cause any problems if all the actions were
equally overestimated, but the case is, that once one specific action
becomes overestimated, it’s more likely to be chosen in the next
iteration making it very hard for the agent to explore the environment
uniformly and find the right policy.</p>

<p>A solution to this problem (of overestimation) was proposed by van
Hasselt in <sup class="footnote-ref" id="fnref:12"><a class="footnote" href="#fn:12">18</a></sup>, and is called Double learning.
In this new
algorithm, two Q functions ( $Q_1$ and $Q_2$ ) are independently
learned. One function is then used to determine the maximizing action
and second to estimate its value. Either $Q_1$ or $Q_2$ is updated
randomly using the same formula as before:
<span  class="math">\(Q_i(s,a) \rightarrow r + \gamma Q_j(s', argmax_a Q_i(s', a))\)</span></p>

<p>Van Hasselt has proven that by decoupling the maximizing action from its
value in this way, one can indeed eliminate the maximization bias
<sup class="footnote-ref" id="fnref:12"><a class="footnote" href="#fn:12">19</a></sup>.</p>

<p>The DDQN is based on this idea, and it uses the target network $Q^-$ as
the second value function, without having to introduce additional
networks. Therefore, the greedy policy is evaluated according to the
online network, but using the target network to estimate its value. The
update is the same as Improved DQN, but with minor change in the target
$y_i$:</p>

<p><span  class="math">\[y_i = r_i + \gamma Q(s_{i+1}, argmax_a Q(s_{i+1}, a; \theta); \theta^-)\]</span></p>

<p>The update to the target network stays unchanged from improved DQN, and
remains a periodic copy of the online network.</p>

<p>In the DDQN paper <sup class="footnote-ref" id="fnref:5"><a class="footnote" href="#fn:5">20</a></sup>, the authors reports that although DDQN
does not always improve performance, it substantially benefits the
stability of learning. This improved stability directly translates to
ability to learn much complicated tasks.</p>

<p>When testing DDQN on 49 Atari games, it achieved about twice the average
score of improved DQN with the same hyperparameters. With tuned
hyperparameters, DDQN achieved almost four time the average score of
improved DQN.</p>

<h1 id="conclusion">Conclusion</h1>

<p>In this study, we have presented the use of deep learning combined with
q-learning to control agents directly from high dimensional sensory
inputs. In particular, we presented the Deep Q-Network algorithm and
it’s variant that marks a milestone in machine learning, by mastering to
play Atari 2600 games based only on raw video frames.</p>

<h3 id="references">References</h3>
<div class="footnotes">

<hr>

<ol>
<li id="fn:1">I. Sutskever A. Krizhevsky and G. Hinton. Imagenet classification with deep convolutional neural networks. In Advances in Neural Information Processing Systems 25, pages 1106–1114, 2012.
 <a class="footnote-return" href="#fnref:1"><sup>^</sup></a></li>
<li id="fn:2">S. Chintala Y. LeCun. P. Sermanet, K. Kavukcuoglu. Pedestrian detection with unsupervised multi-stage feature learning. In Proc. International Conference onComputer Vision and Pattern Recognition (CVPR 2013), 2013.
 <a class="footnote-return" href="#fnref:2"><sup>^</sup></a></li>
<li id="fn:3">D. Silver A. Graves I. Antonoglou D. Wierstra M. Riedmiller V. Mnih, K. Kavukcuoglu. Playing atari with deep reinforcement learning. 2013. 2012
 <a class="footnote-return" href="#fnref:3"><sup>^</sup></a></li>
<li id="fn:4">D. Silver A. A. Rusu J. Veness M. G.Bellemare A. Graves M. Riedmiller A. K. Fidjeland G. Ostrovski S. Petersen C. Beattie A. Sadik I. Antonoglou H. King D. Kumaran D. Wierstra S. Legg V. Mnih, K. Kavukcuoglu and D. Hassabis. Human-level control through deep reinforcement learning. 2015
 <a class="footnote-return" href="#fnref:4"><sup>^</sup></a></li>
<li id="fn:5">D. Silver H. van Hasselt, A. Guez. Deep reinforcement learning with double q-learning. In arXiv:1509.06461v3 [cs.LG], 2015.
 <a class="footnote-return" href="#fnref:5"><sup>^</sup></a></li>
<li id="fn:6">Ch. Watkins. Learning from delayed rewards. 1989
 <a class="footnote-return" href="#fnref:6"><sup>^</sup></a></li>
<li id="fn:7">P. Dayan CH Watkins. Q-learning. In Machine Learning, pages 279–292, 1992
 <a class="footnote-return" href="#fnref:7"><sup>^</sup></a></li>
<li id="fn:8">B. Van Roy John N. Tsitsiklis. An analysis of temporal-difference learning with function approximation. In IEEETrans. Automat. Contr. 42, pages 674–690, 1997
 <a class="footnote-return" href="#fnref:8"><sup>^</sup></a></li>
<li id="fn:4">D. Silver A. A. Rusu J. Veness M. G.Bellemare A. Graves M. Riedmiller A. K. Fidjeland G. Ostrovski S. Petersen C. Beattie A. Sadik I. Antonoglou H. King D. Kumaran D. Wierstra S. Legg V. Mnih, K. Kavukcuoglu and D. Hassabis. Human-level control through deep reinforcement learning. 2015
 <a class="footnote-return" href="#fnref:4"><sup>^</sup></a></li>
<li id="fn:9">Richard Sutton and Andrew Barto. Reinforcement Learning: An Introduction. MIT Press, 1998
 <a class="footnote-return" href="#fnref:9"><sup>^</sup></a></li>
<li id="fn:10">Joel Veness Marc G Bellemare, Yavar Naddaf and Michael Bowling. The arcade learning environment: An evaluation platform for general agents. In Journal of Artificial Intelligence Research, 47, pages 253–279, 2013
 <a class="footnote-return" href="#fnref:10"><sup>^</sup></a></li>
<li id="fn:3">D. Silver A. Graves I. Antonoglou D. Wierstra M. Riedmiller V. Mnih, K. Kavukcuoglu. Playing atari with deep reinforcement learning. 2013. 2012
 <a class="footnote-return" href="#fnref:3"><sup>^</sup></a></li>
<li id="fn:4">D. Silver A. A. Rusu J. Veness M. G.Bellemare A. Graves M. Riedmiller A. K. Fidjeland G. Ostrovski S. Petersen C. Beattie A. Sadik I. Antonoglou H. King D. Kumaran D. Wierstra S. Legg V. Mnih, K. Kavukcuoglu and D. Hassabis. Human-level control through deep reinforcement learning. 2015
 <a class="footnote-return" href="#fnref:4"><sup>^</sup></a></li>
<li id="fn:11">Long-Ji Lin. Reinforcement learning for robots using neural networks. Technical report, DTIC Document, 1993
 <a class="footnote-return" href="#fnref:11"><sup>^</sup></a></li>
<li id="fn:4">D. Silver A. A. Rusu J. Veness M. G.Bellemare A. Graves M. Riedmiller A. K. Fidjeland G. Ostrovski S. Petersen C. Beattie A. Sadik I. Antonoglou H. King D. Kumaran D. Wierstra S. Legg V. Mnih, K. Kavukcuoglu and D. Hassabis. Human-level control through deep reinforcement learning. 2015
 <a class="footnote-return" href="#fnref:4"><sup>^</sup></a></li>
<li id="fn:4">D. Silver A. A. Rusu J. Veness M. G.Bellemare A. Graves M. Riedmiller A. K. Fidjeland G. Ostrovski S. Petersen C. Beattie A. Sadik I. Antonoglou H. King D. Kumaran D. Wierstra S. Legg V. Mnih, K. Kavukcuoglu and D. Hassabis. Human-level control through deep reinforcement learning. 2015
 <a class="footnote-return" href="#fnref:4"><sup>^</sup></a></li>
<li id="fn:5">D. Silver H. van Hasselt, A. Guez. Deep reinforcement learning with double q-learning. In arXiv:1509.06461v3 [cs.LG], 2015.
 <a class="footnote-return" href="#fnref:5"><sup>^</sup></a></li>
<li id="fn:12">H. van Hasselt. Double q-learning. In Advances in Neural Information Processing Systems, 23, pages 2613–2621, 2010
 <a class="footnote-return" href="#fnref:12"><sup>^</sup></a></li>
<li id="fn:12">H. van Hasselt. Double q-learning. In Advances in Neural Information Processing Systems, 23, pages 2613–2621, 2010
 <a class="footnote-return" href="#fnref:12"><sup>^</sup></a></li>
<li id="fn:5">D. Silver H. van Hasselt, A. Guez. Deep reinforcement learning with double q-learning. In arXiv:1509.06461v3 [cs.LG], 2015.
 <a class="footnote-return" href="#fnref:5"><sup>^</sup></a></li>
</ol>
</div>

    </div>

    


    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/reinforcement-learning/">Reinforcement Learning</a>
  
  <a class="badge badge-light" href="/tags/dqn/">DQN</a>
  
  <a class="badge badge-light" href="/tags/atari-2600/">Atari 2600</a>
  
  <a class="badge badge-light" href="/tags/python/">Python</a>
  
</div>



    
      








  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu89c008f47ff8946cace8a4fb81c3947b_29222_250x250_fill_lanczos_center_2.png" itemprop="image" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="https://pvnieo.github.io/">Souhaib Attaiki</a></h5>
      <h6 class="card-subtitle">Applied Mathematics / Computer Science student</h6>
      <p class="card-text" itemprop="description">Passionate about computer vision and machine learning.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://www.linkedin.com/in/souhaib-attaiki-595121102/" target="_blank" rel="noopener">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://www.researchgate.net/profile/Souhaib_Attaiki" target="_blank" rel="noopener">
              <i class="fab fa-researchgate"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/pvnieo" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/project/mangan/">ManGan</a></li>
          
          <li><a href="/project/deeplevi/">Deep Levi</a></li>
          
          <li><a href="/project/searchy/">Searchy</a></li>
          
          <li><a href="/project/algozoo/">My Algorithm Zoo</a></li>
          
          <li><a href="/project/project-euler/">Project Euler solutions</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.0.0/mermaid.min.js" integrity="sha256-0w92bcB21IY5+rGI84MGj52jNfHNbXVeQLrZ0CGdjNY=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/c&#43;&#43;.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © 2020 Souhaib Attaiki, made with lots of ❤️ and steaming hot ☕️. 
    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
